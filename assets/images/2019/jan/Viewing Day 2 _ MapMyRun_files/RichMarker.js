mmf_mapping_api.define([],function(){var t=window.google,e=function(t){var e=t||{};this.ready_=!1,this.dragging_=!1,t.visible=void 0!==t.visible?t.visible:!0,t.shadow=void 0!==t.shadow?t.shadow:"7px -3px 5px rgba(88,88,88,0.7)",t.anchor=void 0!==t.anchor?r[t.anchor.toUpperCase()]:r.BOTTOM,this.setValues(e)};e.prototype=new t.maps.OverlayView,e.prototype.getVisible=function(){return this.get("visible")},e.prototype.getVisible=e.prototype.getVisible,e.prototype.setVisible=function(t){this.set("visible",t)},e.prototype.setVisible=e.prototype.setVisible,e.prototype.visible_changed=function(){this.ready_&&(this.markerWrapper_.style.display=this.getVisible()?"":"none",this.draw())},e.prototype.visible_changed=e.prototype.visible_changed,e.prototype.setFlat=function(t){this.set("flat",!!t)},e.prototype.setFlat=e.prototype.setFlat,e.prototype.getFlat=function(){return this.get("flat")},e.prototype.getFlat=e.prototype.getFlat,e.prototype.getWidth=function(){return this.get("width")},e.prototype.getWidth=e.prototype.getWidth,e.prototype.getHeight=function(){return this.get("height")},e.prototype.getHeight=e.prototype.getHeight,e.prototype.setShadow=function(t){this.set("shadow",t),this.flat_changed()},e.prototype.setShadow=e.prototype.setShadow,e.prototype.getShadow=function(){return this.get("shadow")},e.prototype.getShadow=e.prototype.getShadow,e.prototype.flat_changed=function(){this.ready_&&(this.markerWrapper_.style.boxShadow=this.markerWrapper_.style.webkitBoxShadow=this.markerWrapper_.style.MozBoxShadow=this.getFlat()?"":this.getShadow())},e.prototype.flat_changed=e.prototype.flat_changed,e.prototype.setZIndex=function(t){this.set("zIndex",t)},e.prototype.setZIndex=e.prototype.setZIndex,e.prototype.getZIndex=function(){return this.get("zIndex")},e.prototype.getZIndex=e.prototype.getZIndex,e.prototype.zIndex_changed=function(){this.getZIndex()&&this.ready_&&(this.markerWrapper_.style.zIndex=this.getZIndex())},e.prototype.zIndex_changed=e.prototype.zIndex_changed,e.prototype.getDraggable=function(){return this.get("draggable")},e.prototype.getDraggable=e.prototype.getDraggable,e.prototype.setDraggable=function(t){this.set("draggable",!!t)},e.prototype.setDraggable=e.prototype.setDraggable,e.prototype.draggable_changed=function(){this.ready_&&(this.getDraggable()?this.addDragging_(this.markerWrapper_):this.removeDragListeners_())},e.prototype.draggable_changed=e.prototype.draggable_changed,e.prototype.getPosition=function(){return this.get("position")},e.prototype.getPosition=e.prototype.getPosition,e.prototype.setPosition=function(t){this.set("position",t)},e.prototype.setPosition=e.prototype.setPosition,e.prototype.position_changed=function(){this.draw()},e.prototype.position_changed=e.prototype.position_changed,e.prototype.getAnchor=function(){return this.get("anchor")},e.prototype.getAnchor=e.prototype.getAnchor,e.prototype.setAnchor=function(t){this.set("anchor",t)},e.prototype.setAnchor=e.prototype.setAnchor,e.prototype.anchor_changed=function(){this.draw()},e.prototype.anchor_changed=e.prototype.anchor_changed,e.prototype.htmlToDocumentFragment_=function(t){var e=document.createElement("DIV");if(e.innerHTML=t,1===e.childNodes.length)return e.removeChild(e.firstChild);for(var r=document.createDocumentFragment();e.firstChild;)r.appendChild(e.firstChild);return r},e.prototype.removeChildren_=function(t){if(t)for(var e;e===t.firstChild;)t.removeChild(e)},e.prototype.setContent=function(t){this.set("content",t)},e.prototype.setContent=e.prototype.setContent,e.prototype.getContent=function(){return this.get("content")},e.prototype.getContent=e.prototype.getContent,e.prototype.content_changed=function(){if(this.markerContent_){this.removeChildren_(this.markerContent_);var e=this.getContent();if(e){"string"==typeof e&&(e=e.replace(/^\s*([\S\s]*)\b\s*$/,"$1"),e=this.htmlToDocumentFragment_(e)),this.markerContent_.appendChild(e);for(var r,o=this,i=this.markerContent_.getElementsByTagName("IMG"),s=function(t){o.getDraggable()&&(t.preventDefault&&t.preventDefault(),t.returnValue=!1)},a=function(){o.draw()},n=0,p=i.length;p>n;n++)r=i[n],t.maps.event.addDomListener(r,"mousedown",s),t.maps.event.addDomListener(r,"load",a);t.maps.event.trigger(this,"domready")}this.ready_&&this.draw()}},e.prototype.content_changed=e.prototype.content_changed,e.prototype.setCursor_=function(t){if(this.ready_){var e="";-1!==navigator.userAgent.indexOf("Gecko/")?("dragging"===t&&(e="-moz-grabbing"),"dragready"===t&&(e="-moz-grab"),"draggable"===t&&(e="pointer")):(("dragging"===t||"dragready"===t)&&(e="move"),"draggable"===t&&(e="pointer")),this.markerWrapper_.style.cursor!==e&&(this.markerWrapper_.style.cursor=e)}},e.prototype.startDrag=function(e){if(this.getDraggable()&&!this.dragging_){this.dragging_=!0;var r=this.getMap();this.mapDraggable_=r.get("draggable"),r.set("draggable",!1),this.mouseX_=e.clientX,this.mouseY_=e.clientY,this.setCursor_("dragready"),this.markerWrapper_.style.MozUserSelect="none",this.markerWrapper_.style.KhtmlUserSelect="none",this.markerWrapper_.style.WebkitUserSelect="none",this.markerWrapper_.unselectable="on",this.markerWrapper_.onselectstart=function(){return!1},this.addDraggingListeners_(),t.maps.event.trigger(this,"dragstart")}},e.prototype.stopDrag=function(){this.getDraggable()&&this.dragging_&&(this.dragging_=!1,this.getMap().set("draggable",this.mapDraggable_),this.mouseX_=this.mouseY_=this.mapDraggable_=null,this.markerWrapper_.style.MozUserSelect="",this.markerWrapper_.style.KhtmlUserSelect="",this.markerWrapper_.style.WebkitUserSelect="",this.markerWrapper_.unselectable="off",this.markerWrapper_.onselectstart=function(){},this.removeDraggingListeners_(),this.setCursor_("draggable"),t.maps.event.trigger(this,"dragend"),this.draw())},e.prototype.drag=function(e){if(!this.getDraggable()||!this.dragging_)return this.stopDrag(),void 0;var r=this.mouseX_-e.clientX,o=this.mouseY_-e.clientY;this.mouseX_=e.clientX,this.mouseY_=e.clientY;var i=parseInt(this.markerWrapper_.style.left,10)-r,s=parseInt(this.markerWrapper_.style.top,10)-o;this.markerWrapper_.style.left=i+"px",this.markerWrapper_.style.top=s+"px";var a=this.getOffset_(),n=new t.maps.Point(i-a.width,s-a.height),p=this.getProjection();this.setPosition(p.fromDivPixelToLatLng(n)),this.setCursor_("dragging"),t.maps.event.trigger(this,"drag")},e.prototype.removeDragListeners_=function(){this.draggableListener_&&(t.maps.event.removeListener(this.draggableListener_),delete this.draggableListener_),this.setCursor_("")},e.prototype.addDragging_=function(e){if(e){var r=this;this.draggableListener_=t.maps.event.addDomListener(e,"mousedown",function(t){r.startDrag(t)}),this.setCursor_("draggable")}},e.prototype.addDraggingListeners_=function(){var e=this;this.markerWrapper_.setCapture?(this.markerWrapper_.setCapture(!0),this.draggingListeners_=[t.maps.event.addDomListener(this.markerWrapper_,"mousemove",function(t){e.drag(t)},!0),t.maps.event.addDomListener(this.markerWrapper_,"mouseup",function(){e.stopDrag(),e.markerWrapper_.releaseCapture()},!0)]):this.draggingListeners_=[t.maps.event.addDomListener(window,"mousemove",function(t){e.drag(t)},!0),t.maps.event.addDomListener(window,"mouseup",function(){e.stopDrag()},!0)]},e.prototype.removeDraggingListeners_=function(){if(this.draggingListeners_){for(var e=0,r=this.draggingListeners_.length;r>e;e++)t.maps.event.removeListener(this.draggingListeners_[e]);this.draggingListeners_.length=0}},e.prototype.getOffset_=function(){var e=this.getAnchor();if("object"==typeof e)return e;var o=new t.maps.Size(0,0);if(!this.markerContent_)return o;var i=this.markerContent_.offsetWidth,s=this.markerContent_.offsetHeight;switch(e){case r.TOP_LEFT:break;case r.TOP:o.width=-i/2;break;case r.TOP_RIGHT:o.width=-i;break;case r.LEFT:o.height=-s/2;break;case r.MIDDLE:o.width=-i/2,o.height=-s/2;break;case r.RIGHT:o.width=-i,o.height=-s/2;break;case r.BOTTOM_LEFT:o.height=-s;break;case r.BOTTOM:o.width=-i/2,o.height=-s;break;case r.BOTTOM_RIGHT:o.width=-i,o.height=-s}return o},e.prototype.onAdd=function(){if(this.markerWrapper_||(this.markerWrapper_=document.createElement("DIV"),this.markerWrapper_.style.position="absolute"),this.getZIndex()&&(this.markerWrapper_.style.zIndex=this.getZIndex()),this.markerWrapper_.style.display=this.getVisible()?"":"none",!this.markerContent_){this.markerContent_=document.createElement("DIV"),this.markerWrapper_.appendChild(this.markerContent_);var e=this;t.maps.event.addDomListener(this.markerContent_,"click",function(){t.maps.event.trigger(e,"click")}),t.maps.event.addDomListener(this.markerContent_,"mouseover",function(){t.maps.event.trigger(e,"mouseover")}),t.maps.event.addDomListener(this.markerContent_,"mouseout",function(){t.maps.event.trigger(e,"mouseout")})}this.ready_=!0,this.content_changed(),this.flat_changed(),this.draggable_changed();var r=this.getPanes();r&&r.overlayMouseTarget.appendChild(this.markerWrapper_),t.maps.event.trigger(this,"ready")},e.prototype.onAdd=e.prototype.onAdd,e.prototype.draw=function(){if(this.ready_&&!this.dragging_){var t=this.getProjection();if(t){var e=this.get("position"),r=t.fromLatLngToDivPixel(e),o=this.getOffset_();this.markerWrapper_.style.top=r.y+o.height+"px",this.markerWrapper_.style.left=r.x+o.width+"px";var i=this.markerContent_.offsetHeight,s=this.markerContent_.offsetWidth;s!==this.get("width")&&this.set("width",s),i!==this.get("height")&&this.set("height",i)}}},e.prototype.draw=e.prototype.draw,e.prototype.onRemove=function(){this.markerWrapper_&&this.markerWrapper_.parentNode&&this.markerWrapper_.parentNode.removeChild(this.markerWrapper_),this.removeDragListeners_()},e.prototype.onRemove=e.prototype.onRemove;var r={TOP_LEFT:1,TOP:2,TOP_RIGHT:3,LEFT:4,MIDDLE:5,RIGHT:6,BOTTOM_LEFT:7,BOTTOM:8,BOTTOM_RIGHT:9};return e});
//# sourceMappingURL=RichMarker.js.map